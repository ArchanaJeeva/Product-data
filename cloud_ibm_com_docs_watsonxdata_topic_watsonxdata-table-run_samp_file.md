IBM Cloud Docs Skip to contentIBM CloudCatalogCatalogCost EstimatorCost EstimatorHelpHelpDocsLog inSign upError Skip to content IBM Cloud IBM Cloud CatalogCatalog CatalogCatalog Cost EstimatorCost Estimator Cost EstimatorCost Estimator HelpHelpDocs HelpHelp Docs Docs Docs Log in Log in Sign up Sign up Error Spark table maintenance by using ibm-lh tool Spark table maintenance by using ibm-lh tool You can perform Iceberg table maintenance operations by using Spark with the help of ibm-lh tool. This topic provides information about the following IBMÂ® watsonx.data table maintenance operations that can be done by using Spark with the help ofibm-lh tool. Snapshot management rollback\_to\_snapshot - Roll back a table to a specific snapshot ID. rollback\_to\_timestamp - Roll back the table to a snapshot at a specific day and time. set\_current\_snapshot - Sets the current snapshot ID for a table. cherrypick\_snapshot - Cherry-picks changes from a snapshot into the current table state. Metadata management expire\_snapshots - Remove older snapshots and their files that are no longer needed. remove\_orphan\_files - Used to remove files that are not referenced in any metadata files of an Iceberg table. rewrite\_data\_files - Combines small files into larger files to reduce metadata overhead and runtime file open cost. rewrite\_manifests - Rewrite manifests for a table to optimize scan planning. Table Migration register\_table - Creates a catalog entry for a metadata.json file that exists but does not have a corresponding catalog identifier. For more table operations, see Spark Procedures. Prerequisites Provision IBMÂ® watsonx.data instance Provision IBM Analytics Engine instance Install ibm-lh tool. For more information on how to install ibm-lh tool, see Installing ibm-lh-client. Procedure Follow the steps to run the Spark sample python file. Save the following config.json file to the root location where you installed ibm-lh tool. { "iae": { "iam\_api\_key": "", "iae\_endpoint\_url": "https://api.us-south.ae.cloud.ibm.com/", "api\_auth\_url": "https://iam.cloud.ibm.com/identity/token", "iae\_instance\_id": "XXX" }, "table": { "catalog": "catalog", "schema": "db", "table\_name": "table", "table\_action": "register\_table", "snapshot\_id": "1", "snapshot\_timestamp": "2012-10-31:01:00:00.000", "snapshot\_table": "snapshot\_table", "spark\_catalog": "spark\_catalog", "metadata\_file": "s3a://new-bucket" }, "lakehouse": { "hms\_url": "thrift://XX.XX.XX.XX:9083", "hms\_auth\_type": "PLAIN", "hms\_username": "test", "hms\_password": "password", "lh\_endpoint\_url": "https://s3.us-south.cloud-object-storage.appdomain.cloud", "lh\_access\_key": "", "lh\_secret\_key": "", "app\_url": "s3a://new- bucket/table-ops-job.py" } } Configure the config.json file with the following information. IAE configurations Table 1. IAE configurations Field Description iam\_api\_key Specify the IBM IAE API Key iae\_endpoint\_url IAE Endpoint URL (https://api.us-south.ae.cloud.ibm.com/). api\_auth\_url IAE Authorization API URL (https://iam.cloud.ibm.com/identity/token). iae\_instance\_id IAE Instance ID. Iceberg configurations Table 2. Iceberg configurations Field Description catalog Specify the Iceberg catalog. schema Specify the Iceberg schema. table\_name Specify the Iceberg Table Name. table\_action Specify the table operations to be performed (Options - expire\_snapshots, remove\_orphan\_files, rewrite\_data\_files, rewrite\_manifests, rollback\_to\_snapshot, rollback\_to\_timestamp, set\_current\_snapshot, cherrypick\_snapshot, register\_table). â€œsnapshot\_idâ€: â€œ1" Specify the Iceberg table snapshot ID. snapshot\_timestamp Specify the Iceberg table snapshot timestamp (Format- â€œ2012-10-31:01:00:00.000â€). snapshot\_table Specify the Iceberg table snapshot table name. spark\_catalog Specify the catalog for register\_table action. metadata\_file Specify the metadata path for register\_table action. watsonx.data configurations Table 3. watsonx.data configurations Field Description hms\_URL Specify the HMS URL. hms\_auth\_type Specify the HMS authentication type (default: â€œPLAINâ€). hms\_username Specify the HMS username. hms\_password Specify the HMS Password. lh\_endpoint\_url Specify the Cloud Object Storage Endpoint URL. lh\_access\_key Specify the Cloud Object Storage Access Key. lh\_secret\_key Specify the Cloud Object Storage Secret. app\_URL Specify the Spark Submit Job URL on Cloud Object Storage. Run the following command to start a Spark procedure that performs the table operations (specified in config.json file) on Iceberg table. Provide the config.json file path as the file-name. ./ibm-lh table-maint --file For more information about the ibm-lh tool table maintenance utility, see Table maintenance. Spark table maintenance by using ibm-lh tool You can perform Iceberg table maintenance operations by using Spark with the help of ibm-lh tool. This topic provides information about the following IBMÂ® watsonx.data table maintenance operations that can be done by using Spark with the help ofibm-lh tool. Snapshot management rollback\_to\_snapshot - Roll back a table to a specific snapshot ID. rollback\_to\_timestamp - Roll back the table to a snapshot at a specific day and time. set\_current\_snapshot - Sets the current snapshot ID for a table. cherrypick\_snapshot - Cherry-picks changes from a snapshot into the current table state. Snapshot management rollback\_to\_snapshot - Roll back a table to a specific snapshot ID. rollback\_to\_timestamp - Roll back the table to a snapshot at a specific day and time. set\_current\_snapshot - Sets the current snapshot ID for a table. cherrypick\_snapshot - Cherry- picks changes from a snapshot into the current table state. Metadata management expire\_snapshots - Remove older snapshots and their files that are no longer needed. remove\_orphan\_files - Used to remove files that are not referenced in any metadata files of an Iceberg table. rewrite\_data\_files - Combines small files into larger files to reduce metadata overhead and runtime file open cost. rewrite\_manifests - Rewrite manifests for a table to optimize scan planning. Metadata management expire\_snapshots - Remove older snapshots and their files that are no longer needed. remove\_orphan\_files - Used to remove files that are not referenced in any metadata files of an Iceberg table. rewrite\_data\_files - Combines small files into larger files to reduce metadata overhead and runtime file open cost. rewrite\_manifests - Rewrite manifests for a table to optimize scan planning. Table Migration register\_table - Creates a catalog entry for a metadata.json file that exists but does not have a corresponding catalog identifier. Table Migration register\_table - Creates a catalog entry for a metadata.json file that exists but does not have a corresponding catalog identifier. For more table operations, see Spark Procedures. Spark Procedures Prerequisites Provision IBMÂ® watsonx.data instance Provision IBM Analytics Engine instance Install ibm-lh tool. For more information on how to install ibm-lh tool, see Installing ibm-lh-client. Installing ibm-lh-client Procedure Follow the steps to run the Spark sample python file. Save the following config.json file to the root location where you installed ibm-lh tool. { "iae": { "iam\_api\_key": "", "iae\_endpoint\_url": "https://api.us-south.ae.cloud.ibm.com/", "api\_auth\_url": "https://iam.cloud.ibm.com/identity/token", "iae\_instance\_id": "XXX" }, "table": { "catalog": "catalog", "schema": "db", "table\_name": "table", "table\_action": "register\_table", "snapshot\_id": "1", "snapshot\_timestamp": "2012-10-31:01:00:00.000", "snapshot\_table": "snapshot\_table", "spark\_catalog": "spark\_catalog", "metadata\_file": "s3a://new-bucket" }, "lakehouse": { "hms\_url": "thrift://XX.XX.XX.XX:9083", "hms\_auth\_type": "PLAIN", "hms\_username": "test", "hms\_password": "password", "lh\_endpoint\_url": "https://s3.us-south.cloud-object- storage.appdomain.cloud", "lh\_access\_key": "", "lh\_secret\_key": "", "app\_url": "s3a://new-bucket/table-ops-job.py" } } Save the following config.json file to the root location where you installed ibm-lh tool. Configure the config.json file with the following information. IAE configurations Table 1. IAE configurations Field Description iam\_api\_key Specify the IBM IAE API Key iae\_endpoint\_url IAE Endpoint URL (https://api.us- south.ae.cloud.ibm.com/). api\_auth\_url IAE Authorization API URL (https://iam.cloud.ibm.com/identity/token). iae\_instance\_id IAE Instance ID. Iceberg configurations Table 2. Iceberg configurations Field Description catalog Specify the Iceberg catalog. schema Specify the Iceberg schema. table\_name Specify the Iceberg Table Name. table\_action Specify the table operations to be performed (Options - expire\_snapshots, remove\_orphan\_files, rewrite\_data\_files, rewrite\_manifests, rollback\_to\_snapshot, rollback\_to\_timestamp, set\_current\_snapshot, cherrypick\_snapshot, register\_table). â€œsnapshot\_idâ€: â€œ1" Specify the Iceberg table snapshot ID. snapshot\_timestamp Specify the Iceberg table snapshot timestamp (Format-â€œ2012-10-31:01:00:00.000â€). snapshot\_table Specify the Iceberg table snapshot table name. spark\_catalog Specify the catalog for register\_table action. metadata\_file Specify the metadata path for register\_table action. watsonx.data configurations Table 3. watsonx.data configurations Field Description hms\_URL Specify the HMS URL. hms\_auth\_type Specify the HMS authentication type (default: â€œPLAINâ€). hms\_username Specify the HMS username. hms\_password Specify the HMS Password. lh\_endpoint\_url Specify the Cloud Object Storage Endpoint URL. lh\_access\_key Specify the Cloud Object Storage Access Key. lh\_secret\_key Specify the Cloud Object Storage Secret. app\_URL Specify the Spark Submit Job URL on Cloud Object Storage. Configure the config.json file with the following information. IAE configurations iam\_api\_key Specify the IBM IAE API Key iae\_endpoint\_url IAE Endpoint URL (https://api.us-south.ae.cloud.ibm.com/). https://api.us-south.ae.cloud.ibm.com/ api\_auth\_url IAE Authorization API URL (https://iam.cloud.ibm.com/identity/token). https://iam.cloud.ibm.com/identity/token iae\_instance\_id IAE Instance ID. Iceberg configurations catalog Specify the Iceberg catalog. schema Specify the Iceberg schema. table\_name Specify the Iceberg Table Name. table\_action Specify the table operations to be performed (Options - expire\_snapshots, remove\_orphan\_files, rewrite\_data\_files, rewrite\_manifests, rollback\_to\_snapshot, rollback\_to\_timestamp, set\_current\_snapshot, cherrypick\_snapshot, register\_table). â€œsnapshot\_idâ€: â€œ1" Specify the Iceberg table snapshot ID. snapshot\_timestamp Specify the Iceberg table snapshot timestamp (Format-â€œ2012-10-31:01:00:00.000â€). snapshot\_table Specify the Iceberg table snapshot table name. spark\_catalog Specify the catalog for register\_table action. metadata\_file Specify the metadata path for register\_table action. watsonx.data configurations hms\_URL Specify the HMS URL. hms\_auth\_type Specify the HMS authentication type (default: â€œPLAINâ€). hms\_username Specify the HMS username. hms\_password Specify the HMS Password. lh\_endpoint\_url Specify the Cloud Object Storage Endpoint URL. lh\_access\_key Specify the Cloud Object Storage Access Key. lh\_secret\_key Specify the Cloud Object Storage Secret. app\_URL Specify the Spark Submit Job URL on Cloud Object Storage. Run the following command to start a Spark procedure that performs the table operations (specified in config.json file) on Iceberg table. Provide the config.json file path as the file-name. ./ibm-lh table- maint --file Run the following command to start a Spark procedure that performs the table operations (specified in config.json file) on Iceberg table. Provide the config.json file path as the file-name. For more information about the ibm-lh tool table maintenance utility, see Table maintenance. Table maintenance
